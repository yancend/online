<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>

    <title></title>
    <script type="text/javascript" src="lib/jquery-1.5.1.js"></script>
    <script type="text/javascript" src="config.js"></script>

</head>
<body>
<div style="left:300px; position:relative;  width: 1000px">
    <form id="form" name="submitfForm" method="post" style="">
        <p>本地工程地址
            <input id="localWS"
                   name="localWorkSpaceName" type="text" /></p>

        <p>github地址
            <input id="githubRepos"
                   name="githubWorkSpaceName" type="text"/>
            tag号
            <input id="tagNum"
                   name="tagNumName" type="text"/></p>

        <p>版本号
            <input id="Version"
                   name="VersionName" type="text"/></p>

    </form>
    <button onclick="getRepos()" style="float:left;"> 检测</button>

    <div id='result' style="display: none"><p></p></div>
    <button id='nextButton' disabled="disabled" onClick="window.location.href='./grunt.html?workspace='+workspace;">下一步
    </button>
</div>
</body>
<script type="text/javascript">
    $("#localWS")[0].value = Config['localWS'];
    $("#githubRepos")[0].value = Config['githubRepos'];
    $("#tagNum")[0].value = Config['tagNum'];
    $("#Version")[0].value = Config['Version'];

    var savedSuccessMsg = "检测通过 !";
    var savedFailMsg = "检测异常 !";
    var workspace;
    function getRepos() {
        if(!$("#localWS")[0].value ||!$("#githubRepos")[0].value||!$("#Version")[0].value||!$("#tagNum")[0].value){
            alert("请填写完整信息");
            return;
        }
        workspace = $("#localWS")[0].value;
        $.ajax({
            url: 'php/getRepos.php',
            type: 'post',
            data: $("#form").serialize(),
            success: function (msg) {
                if (!msg || !eval("(" + msg + ")")) {//没有返回结果或者返回false
                    //todo
//                    $("#result").attr('style',"display: block");
//                    $("#result").text(savedFailMsg);
                    return;
                }
                else {
                    var rel = eval("(" + msg + ")");
                    if(rel === true){
                        $("#nextButton").attr('disabled', "");
                        //todo
//                    $("#result").attr('style',"display: block");
//                    $("#result").text(savedSuccessMsg);
                    }else{
                        //todo
//                    $("#result").attr('style',"display: block");
//                    $("#result").text('检测未通过:\n'+rel);
                        return;
                    }

                }
            },
            error: function (xhr, msg) {
                alert("error 1");
            }
        });
    }
</script>
</html>