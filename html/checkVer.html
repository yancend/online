<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>

    <title></title>
    <script type="text/javascript" src="./lib/jquery-1.5.1.js"></script>
    <script type="text/javascript" src="./config.js"></script>
    <script type="text/javascript" src="./js/helpers.js"></script>

</head>
<body>
<div style="left:300px; position:relative;  width: 1000px">
    <form id="form" name="submitfForm" method="post" style="">

        <p>版本号
            <input id="Version"
                   name="VersionName" type="text"/></p>

    </form>
    <button onclick="checkDetail()" style="float:left;"> 检测</button>

    <div id='result' style="display: none"><p></p></div>
    <button id='nextButton' disabled="disabled" onClick="nextStep();">下一步
    </button>
</div>
</body>
<script type="text/javascript">
    //todo 从配置设默认值
    function defaultFunction(){
        $("#Version")[0].value = Config['Version'];
    }
    defaultFunction();
    function checkDetail() {

        var savedSuccessMsg = "检测通过 !";
        var savedFailMsg = "检测异常 !";
        var workspace;
        if(!$("#Version")[0].value){
            alert("请填写完整信息");
            return;
        }
        workspace = Config['Version'];
        $.ajax({
            url: 'php/checkVer.php',
            type: 'post',
            data: $("#form").serialize(),//todo 再传一个版本号
            success: function (msg) {
                if (!msg || !eval("(" + msg + ")")) {//没有返回结果
                    //todo
                    $("#result").attr('style',"display: block");
                    $("#result").text(savedFailMsg);
                    return;
                }
                else {
                    var rel = eval("(" + msg + ")");
                    if(rel == true){
                        alert(rel);

                        $("#nextButton").attr('disabled', "");
                        //todo
                    $("#result").attr('style',"display: block");
                    $("#result").text(savedSuccessMsg);
                    }else{
                        //todo
                    $("#result").attr('style',"display: block");
                    $("#result").text('检测未通过:\n'+rel);
                        return;
                    }

                }
            },
            error: function (xhr, msg) {
                alert("error 1");
            }
        });
    }
</script>
</html>