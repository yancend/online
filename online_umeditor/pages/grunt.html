<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>

    <title></title>
    <script type="text/javascript" src="../lib/jquery-1.5.1.js"></script>
    <script type="text/javascript" src="./config.js"></script>
    <script type="text/javascript" src="./js/helpers.js"></script>
</head>

<body>
<p>grunt</p>
<button onclick="checkDetail(0)" style="float:left;"> npm install</button>

<button onclick="checkDetail(1)" style="float:left;"> 使用grunt生成dist</button>

<button id="toEnable_1" onclick="checkDetail(2)" style="float:left;"> 检查目标编码</button>

<button id="toEnable_2" onclick="checkDetail(3)" style="float:left;"> 检查目标文件</button>

<!--disabled="disabled"-->

<div id='result' style="display: none"><p></p></div>

<button id='nextButton' disabled="disabled" onClick="nextStep();">下一步</button>

<button id='rollbackButton' onClick="rollback(0);">未通过</button>
</body>
<script type="text/javascript">

    //todo 从配置设默认值
    function defaultFunction() {

    }
    defaultFunction();
    function checkDetail(option) {

        var ws = {};
        ws['config'] = location.search.substring(1);
        ws['basePath'] = Config['basePath_dist'];

        var failMsg = "grunt调用异常 !";
        var phpUrl,flag = false;
        switch (option) {
            case 0:
                phpUrl = "php/npmInstall.php";
                break;
            case 1:
                phpUrl = "php/checkGrunt.php";
                break;
            case 2:
                phpUrl = "php/checkEncode.php";
                break;
            case 3:
                phpUrl = "php/checkFiles.php";
                break;
        }
        $.ajax({
            url: phpUrl,
            type: 'post',
            data: ws,
            success: function (msg) {
                if (!msg || !eval("msg")) {//没有返回结果或者返回false
                    //todo
//                    $("#result").attr('style',"display: block");
//                    $("#result").text(failMsg);
                    return;
                }
                else {
                    var rel = eval("msg");
                    if (rel == true) {
                        $("#result").attr('style', "display: block");

                        if (option == 0) {
                            if (rel === '1') {
                                $("#result").html("成功");
                            } else {
                                $("#result").html("出错");
                            }
                        }
                        else if (option == 1&&rel === '1') {
                            $("#result").html("");

                            $("#toEnable_1").attr('disabled', "");
                            $("#toEnable_2").attr('disabled', "");
                            $("#result").html("<a href='./"+Config['proPath']+"/"+Config['basePath_dist']+"' target='_blank'>目标目录</a>");
                        } else if(option == 2){
                            if (rel === '1') {
                                $("#result").html("编码检查正确");
                                flag = true;
                                debugger

                            } else {
                                $("#result").html("出错");
                            }
                        } else if (option == 3) {
                            if($("#result").html()=="编码检查正确"&&rel === '1'){
                                $('#nextButton').attr('disabled', '');
                                $("#result").html("文件检查正确");
                            }
                        }
                    }
                    else {
                        //todo
                        $("#result").attr('style', "display: block");
                        $("#result").text('检测未通过:\n' + rel);
                        return;
                    }
                }

            },
            error: function (xhr, msg) {
                alert("error 2");
            }
        });
    }
    function checkFiles() {
        var ws = {};
        ws['basePath'] = Config['basePath_dist'];
        $.ajax({
            url: "php/checkFiles.php",
            type: 'post',
            data: ws,
            success: function (msg) {
                if (!msg) {//没有返回结果或者返回false
                    //todo
//                    $("#result").attr('style',"display: block");
//                    $("#result").text(failMsg);
                    return;
                }
                else {
                    $("#manual").attr('disabled', "");
                }

            },
            error: function (xhr, msg) {
                alert("error 2");
            }
        });
    }
    //todo 加一个能点开bat直接编辑的按钮
</script>
</html>